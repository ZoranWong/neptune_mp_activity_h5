(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{148:function(t,e,a){"use strict";a.r(e);var n=a(0),r=a.n(n),o=a(20),i=a.n(o),s=(a(87),a(12)),c=a(13),l=a(15),p=a(14),u=a(16),d=(a(88),a(74)),m=a.n(d),h={apiUrl:"http://neptune.klsfood.cn",apiPrefix:"",tokenKey:"ACCESS_TOKEN",storageUserKey:"USER_STORAGE"},f=a(150),g=m.a.create({baseURL:h.apiUrl+"/"+h.apiPrefix,headers:{Accept:"*/*"},timeout:h.timeout});g.interceptors.request.use(function(t){return t.headers.Authorization="",t},function(t){Promise.reject(t)}),g.interceptors.response.use(function(t){return t.data},function(t){if(void 0===t||"502"===t.code)return f.a.error("\u670d\u52a1\u5668\u8bf7\u6c42\u8d85\u65f6"),Promise.reject(t);var e=t.response;return console.log(e,"========"),e&&e.status?(f.a.error(e.data.message),f.a.error(e.data.message),Promise.reject(t)):void 0});var y=g;var x=function(t){function e(t){var a;return Object(s.a)(this,e),(a=Object(l.a)(this,Object(p.a)(e).call(this,t))).state={image:""},a}return Object(u.a)(e,t),Object(c.a)(e,[{key:"componentDidMount",value:function(){this.setState({image:this.props.data})}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("img",{src:this.state.image,alt:"",mode:"widthFix",style:{width:"100%",height:"auto"}}))}}]),e}(n.Component),b={productsStyle:{width:"100%",background:"#fff",boxSizing:"border-box",padding:"0 10px",transform:"translateY(-35px)",borderTopLeftRadius:"10px",borderTopRightRadius:"10px"},liStyle:{width:"100%",padding:"15px 10px",display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"1px solid #f2f2f2",boxSizing:"border-box"},imageStyle:{width:"114px",height:"114px"},productStyle:{flex:"1",display:"flex",justifyContent:"center",alignItems:"flex-start",flexDirection:"column",marginLeft:"15px",boxSizing:"border-box"},h3Style:{fontSize:"15px",color:"#111",fontWeight:"bold",marginTop:"2px",marginBottom:"6px"},descStyle:{fontSize:"12px",color:"#999"},tagStyle:{padding:"0 4px",color:"#fb4e26",border:"1px solid #ffb7a9",borderRadius:"3px",marginTop:"4px",fontSize:"9px",fontStyle:"normal"},priceStyle:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"flex-end"},leftStyle:{display:"flex",justifyContent:"flex-start",alignItems:"flex-end"},iStyle:{fontSize:"12px",color:"#FC3C2F",fontWeight:"bold",transform:"translateY(-2px)",fontStyle:"normal"},h4Style:{fontSize:"16px",color:"#FC3C2F",fontWeight:"bold",margin:0},spanStyle:{fontSize:"11px",color:"#999",textDecoration:"line-through",marginLeft:"5px",transform:"translateY(-1px)"},imgStyle:{width:"24px",height:"24px"}},S=function(t){function e(t){var a;return Object(s.a)(this,e),(a=Object(l.a)(this,Object(p.a)(e).call(this,t))).checkInCart=function(t,e){t.stopPropagation();var n=a.props.productsInCart;if(n.length){for(var r=!1,o={},i=0;i<n.length;i++){var s=n[i];if(s.product_stock_id===e.product_stock_id){r=!0,o=s;break}r=!1}r?a.changeBuyNum(o.id,o.buy_num+1):a.addToCart(e.product_stock_id,1)}else a.addToCart(e.product_stock_id,1)},a.addToCart=function(t,e){var n;(n={product_stock_id:t,buy_num:1,token:a.props.token},y({url:"api/mp/mall/carts",method:"post",data:n})).then(function(t){a.props.refresh(a.props.token)})},a.changeBuyNum=function(t,e){var n,r;(n={buy_num:e,token:a.props.token},r=t,y({url:"api/mp/mall/carts/".concat(r),method:"put",data:n})).then(function(t){a.props.refresh(a.props.token)})},a.productDetail=function(t){window.wx.miniProgram.navigateTo({url:"/pages/user/goodDetail/main?type=mall&good_id=".concat(t.product_id)})},a.state={products:[]},a}return Object(u.a)(e,t),Object(c.a)(e,[{key:"componentDidMount",value:function(){var t,e=this;(t={ids:this.props.data},y({url:"/api/mp/activity/products",method:"get",params:t})).then(function(t){e.setState({products:t.data})})}},{key:"render",value:function(){var t=this,e=this.state.products;return r.a.createElement("div",null,r.a.createElement("ul",{style:b.productsStyle},e.length&&e.map(function(e,a){return r.a.createElement("li",{style:b.liStyle,key:a,onClick:function(){return t.productDetail(e)}},r.a.createElement("img",{style:b.imageStyle,src:e.product_stock.product_entity.image,alt:""}),r.a.createElement("div",{style:b.productStyle},r.a.createElement("h3",{style:b.h3Style},e.product_stock.product_entity.name),r.a.createElement("span",{style:b.descStyle},"\u51c0\u542b\u91cf:384g"),r.a.createElement("span",{style:b.descStyle},"\u9500\u91cf:",e.product_stock.product_entity.total_sales),r.a.createElement("em",{style:b.tagStyle},"\u65b0\u4eba\u4e13\u4eab"),r.a.createElement("div",{style:b.priceStyle},r.a.createElement("div",{style:b.leftStyle},r.a.createElement("i",{style:b.iStyle},"\uffe5"),r.a.createElement("h4",{style:b.h4Style},e.act_price),r.a.createElement("span",{style:b.spanStyle},"\uffe5",e.product_stock.product_entity.retail_price)),r.a.createElement("img",{style:b.imgStyle,onClick:function(a){return t.checkInCart(a,e)},src:"./add.png",alt:""}))))})))}}]),e}(n.Component),v=function(t){function e(){return Object(s.a)(this,e),Object(l.a)(this,Object(p.a)(e).apply(this,arguments))}return Object(u.a)(e,t),Object(c.a)(e,[{key:"componentDidMount",value:function(){console.log(this.props)}},{key:"render",value:function(){return r.a.createElement("div",{style:{width:"100%",height:this.props.height+"px",display:"flex",justifyContent:"flex-start",alignItems:"center",background:"#f6f6f6",padding:"0 10px",boxSizing:"border-box"}})}}]),e}(n.Component),k=function(t){function e(t){var a;return Object(s.a)(this,e),(a=Object(l.a)(this,Object(p.a)(e).call(this,t))).refresh=function(t){var e;(e={token:t},y({url:"api/mp/mall/carts",method:"get",params:e})).then(function(t){a.setState({productsInCart:t.data})}).catch(function(t){})},a.caculateCartQuantity=function(){for(var t=0,e=a.state.productsInCart,n=0;n<e.length;n++)t+=Number(e[n].buy_num);return t},a.getQueryVariable=function(t){for(var e=window.location.search.substring(1).split("&"),a=0;a<e.length;a++){var n=e[a].split("=");if(n[0]==t)return n[1]}return!1},a.renderTemplate=function(t){var e={data:t.data,key:t.name,token:a.state.token,productsInCart:a.state.productsInCart,refresh:a.refresh};switch(t.name){case"SHARE_BUTTON":return r.a.createElement(x,e);case"PRODUCTS":return r.a.createElement(S,e);default:return""}},a.goShoppingCart=function(){window.wx.miniProgram.navigateTo({url:"/pages/user/ShoppingCart/main"})},a.state={actId:[],data:{},templates:[],title:"",productsInCart:[],token:"",statusHeight:0},a}return Object(u.a)(e,t),Object(c.a)(e,[{key:"componentDidMount",value:function(){var t=this,e=this.getQueryVariable("activity_id"),a=this.getQueryVariable("token"),n=this.getQueryVariable("headHeight"),r=this.getQueryVariable("mainHeight");this.setState({actId:e,token:a,statusHeight:n,mainHeight:r},function(){t.refresh(a)}),function(t,e){return y({url:"/api/mp/activities/".concat(e),method:"get",params:t})}({},e).then(function(e){t.setState({data:e.data,templates:e.data.template,title:e.data.name})}).catch(function(t){})}},{key:"componentWillUnmount",value:function(){window.wx.miniProgram.postMessage({data:"xxxxxxxx"})}},{key:"render",value:function(){var t=this,e=this.state,a=e.templates,n=e.title;return r.a.createElement("div",{className:"App",style:{position:"relative"}},r.a.createElement(v,{title:n,height:this.state.statusHeight}),r.a.createElement("div",{style:{height:this.state.mainHeight+"px",overflow:"auto"}},a.map(function(e){return t.renderTemplate(e)}),r.a.createElement("div",{style:{position:"fixed",left:"20px",bottom:"125px",width:"48px",height:"48px",borderRadius:"50%",background:"rgba(17,17,17,0.3)",display:"flex",justifyContent:"center",alignItems:"center"},onClick:this.goShoppingCart},r.a.createElement("img",{src:"./white_cart.png",style:{width:"24px",height:"24px"},alt:""}),this.state.productsInCart.length?r.a.createElement("span",{style:{position:"absolute",top:"4px",right:"-5px",width:"20px",height:"20px",borderRadius:"100%",background:"#FE3B32",color:"#fff",border:"1px solid #fff",display:"flex",justifyContent:"center",alignItems:"center"}},this.caculateCartQuantity()):""),r.a.createElement("div",{style:{width:"100%",height:"40px",display:"flex",justifyContent:"center",alignItems:"center",background:"#f4f1f4",fontSize:"11px",color:"#b3b3b3"}},"- \u6211\u662f\u6709\u5e95\u7ebf\u7684 -")))}}]),e}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(k,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})},82:function(t,e,a){t.exports=a(148)},87:function(t,e,a){},88:function(t,e,a){}},[[82,1,2]]]);
//# sourceMappingURL=main.294a47ef.chunk.js.map